<html>
<head>
  <link rel="stylesheet" href="stylesheets/comingsoon.css">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
</head>
<body  style="background-color:#E6E6FA;width=100%;height:100%">
  <div class="center" >
    <div class="overlay">
      <canvas style="position:absolute;left:0;top:0" id="myCanvas" width="500px" height="500px" >
                <!-- Insert fallback content here -->
      </canvas>
      <div style="position:absolute;left:500px;top:0;text-align:left;color:blue" id="myStats" >
                <!-- Insert fallback content here -->
      </div>
    </div>
  </div>
  <script>
          var DEBUG_MODE = true;
          var PADDLE_START_POINT = 20;
          var PADDLE_END_POINT = 380;
          var KEYCODE_W=119;
          var KEYCODE_S=115;
          var PLAYER1_DOWN_KEYCODE=KEYCODE_S;
          var PLAYER1_UP_KEYCODE=KEYCODE_W;
          var UPWARD_MOVE_ACCELARATION_PLAYER1=1;
          var DOWNWARD_MOVE_ACCELARATION_PLAYER1=1;
          var PLAYER1_UPWARD_DEACCELARATE = 1;
          var PLAYER1_DOWNWARD_DEACCELARATE = 1;
          var ACCELARATION_INVERTION = true;
          var HIT_EDGE_FREEZE = true;
          var OPOSITE_KEY_NOT_PRESSED = false;
          var HIT_EDGE = false;
          var CHANGED_KEY_AFTER_HIT_EDGE = false;
          function startGame(){
              console.log("Starting Game");
              //Initialize game variables
              console.log("Initializing Game");
              initializeGame();
              //load game images and start game afterwards
              console.log("Loading Game Images");
              loadGameImages(beginEngine);
          }
          function beginEngine(){
            console.log("Starting engine up");
            //start draw loop set how many drame persecond for game
            console.log("Starting Render Loop");
            renderLoop(100);
            //start draw loop set how many drame persecond for game
            console.log("Start Logic Loop");
            logicLoop(100);
          }
          function initializeGame(){
            initializePlayers();
            initializeBall();
            //initialize key keeper as either 1 for up or 0 for down
            window.CURRENT_KEY =1;
          }
          function  initializePlayers(){
            // Initialize player1
            console.log("Initializing Player1");
            window.player1={};
            player1.y=PADDLE_START_POINT;
            player1.dy=0;
          }
          function  initializeBall(){
            // Initialize ball
            console.log("Initializing Ball1");
            window.gameball={};
            gameball.x=30;
            gameball.dx=1;
            gameball.y=30;
            gameball.dy=1;
            gameball.x1=35;
            gameball.dx1=gameball.dx;
            gameball.y1=35;
            gameball.dy1=gameball.dy;
            gameball.x2=40;
            gameball.dx2=gameball.dx1;
            gameball.y2=40;
            gameball.dy2=gameball.dy1;
          }
          function  loadGameImages(callback){
            //Horizontal walls load
            window.horizontal_wall = new Image();
            horizontal_wall.src = "images/horizontal_wall.png";
            //Side walls load
            window.side_wall = new Image();
            side_wall.src = "images/side_wall.png";
            //Paddle walls load
            window.paddle = new Image();
            paddle.src = "images/paddle.png";
            //Soccer walls load
            window.soccer = new Image();
            soccer.src = "images/soccer.png";
            //ball walls load
            window.ball = new Image();
            ball.src = "images/ball.png";
            //ball walls load
            window.ball_shadow = new Image();
            ball_shadow.src = "images/ball_shadow.png";
            //ball walls load
            window.ball_shadow_2 = new Image();
            ball_shadow_2.src = "images/ball_shadow_2.png";
            $(horizontal_wall).load(function() {
              $(side_wall).load(function() {
                $(paddle).load(function() {
                  $(soccer).load(function() {
                    $(ball).load(function() {
                      $(ball_shadow).load(function() {
                        $(ball_shadow_2).load(function() {
                            //All game images are loaded
                            console.log("Loaded all Images");
                            try{
                              console.log("Calling callback");
                              callback();
                            }catch(e){};
                        });
                      });
                    });
                  });
                });
              });
            });
          }
          function movePlayer1Up(){
            console.log("Incrementing players acceleration upward");
            player1.dy-=UPWARD_MOVE_ACCELARATION_PLAYER1;
          }
          function movePlayer1Down(){
            console.log("Incrementing players acceleration downward");
            player1.dy+=DOWNWARD_MOVE_ACCELARATION_PLAYER1;
          }
          function  renderLoop(redrawTimeInSeconds){
              console.log("Setting up render loop every "+ redrawTimeInSeconds);
              //redraw_frame
              setInterval(function(){
                //console.log("Drawing frame");
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(horizontal_wall, 0, 0);
                ctx.drawImage(horizontal_wall, 0, 480);
                ctx.drawImage(side_wall, 485, 20);
                ctx.drawImage(paddle, 0, player1.y);
                ctx.drawImage(ball, gameball.x, gameball.y);
                ctx.drawImage(ball_shadow, gameball.x1, gameball.y1);
                ctx.drawImage(ball_shadow_2, gameball.x2, gameball.y2);
                if(DEBUG_MODE)
                    render_vars();
              }, redrawTimeInSeconds);
          }
          function render_vars(){
            $('#myStats').html("<br>PADDLE_START_POINT =" +  PADDLE_START_POINT
              + "<br>PADDLE_END_POINT =" +PADDLE_END_POINT
              + "<br>PLAYER1_DOWN_KEYCODE =" +PLAYER1_DOWN_KEYCODE
              + "<br>PLAYER1_UP_KEYCODE =" +PLAYER1_UP_KEYCODE
              + "<br>UPWARD_MOVE_ACCELARATION_PLAYER1 =" +UPWARD_MOVE_ACCELARATION_PLAYER1
              + "<br>DOWNWARD_MOVE_ACCELARATION_PLAYER1 =" +DOWNWARD_MOVE_ACCELARATION_PLAYER1
              + "<br>PLAYER1_UPWARD_DEACCELARATE =" +PLAYER1_UPWARD_DEACCELARATE
              + "<br>PLAYER1_DOWNWARD_DEACCELARATE =" +PLAYER1_DOWNWARD_DEACCELARATE
              + "<br>ACCELARATION_INVERTION =" +ACCELARATION_INVERTION
              + "<br>HIT_EDGE_FREEZE =" +HIT_EDGE_FREEZE
              + "<br>OPOSITE_KEY_NOT_PRESSED =" + OPOSITE_KEY_NOT_PRESSED
              + "<br>CURRENT_KEY =" +  CURRENT_KEY
              + "<br>player1.y =" +player1.y
              + "<br>player1.dy =" +player1.dy
              + "<br>gameball.y =" +gameball.y
              + "<br>gameball.dy =" +gameball.dy
              + "<br>gameball.x =" +gameball.x
              + "<br>gameball.dx =" +gameball.dx
              + "<br>gameball.y1 =" +gameball.y1
              + "<br>gameball.dy1 =" +gameball.dy1
              + "<br>gameball.x1 =" +gameball.x1
              + "<br>gameball.dx1 =" +gameball.dx1
              + "<br>gameball.y2 =" +gameball.y2
              + "<br>gameball.dy2 =" +gameball.dy2
              + "<br>gameball.x2 =" +gameball.x2
              + "<br>gameball.dx2 =" +gameball.dx2
              + "<br>HIT_EDGE =" +HIT_EDGE
              + "<br>CHANGED_KEY_AFTER_HIT_EDGE ="+CHANGED_KEY_AFTER_HIT_EDGE
            );
          }
          function  logicLoop(updateLogicTimeInSeconds){
            console.log("Updating game loop logic every "+updateLogicTimeInSeconds);
              //redraw_frame
              setInterval(function(){
                  //console.log("Updating player one position");

                  //Check if player hit edge
                  if(player1.y<PADDLE_START_POINT){
                    window.HIT_EDGE=true;
                    player1.y=PADDLE_START_POINT;
                    if(ACCELARATION_INVERTION)
                      player1.dy*=-1;
                    else
                        player1.dy=0;
                  }else if(player1.y>PADDLE_END_POINT){
                    window.HIT_EDGE=true;
                    player1.y=PADDLE_END_POINT;
                    if(ACCELARATION_INVERTION)
                      player1.dy*=-1;
                    else
                        player1.dy=0;
                  } else {
                    window.HIT_EDGE=false;
                  }
                  //check if key has changed after hitting edge
                  CHANGED_KEY_AFTER_HIT_EDGE = HIT_EDGE?true:CHANGED_KEY_AFTER_HIT_EDGE;
                  if(!OPOSITE_KEY_NOT_PRESSED){
                    CHANGED_KEY_AFTER_HIT_EDGE=false;
                  }
                  var paddle_frozen = HIT_EDGE_FREEZE && CHANGED_KEY_AFTER_HIT_EDGE;
                  if(!paddle_frozen)
                    player1.y+=player1.dy;
                  //slow down paddle by applying de acceleration
                  if(player1.dy!=0){
                    if(player1.dy>0){
                      player1.dy-=PLAYER1_DOWNWARD_DEACCELARATE;
                    }else{
                      player1.dy+=PLAYER1_UPWARD_DEACCELARATE;
                    }
                  }
              }, updateLogicTimeInSeconds);
          }
          $(document).ready(function() {
              console.log("Document Ready");
              //Draw menu screen
              var canvas = document.getElementById("myCanvas");
              var ctx = canvas.getContext("2d");
              var image = new Image();
              image.src = "images/pong.png";
              $(image).load(function() {
                   ctx.drawImage(image, 0, 0);
                   $('#myCanvas').on("click",startGame);
                   $(document).on("keypress",function( e ) {
                        var keycode=e.keyCode || e.which;
                        if ( keycode == 13 ) {
                            startGame();
                            return;
                        }
                        //Check if game started
                        if(player1){

                            //turn uppercase to lower case
                            if(keycode<90){
                              keycode+=32;
                            }
                            //Check if key pressed has changed
                            if ( keycode ==  PLAYER1_UP_KEYCODE ||  keycode ==  PLAYER1_DOWN_KEYCODE){
                              OPOSITE_KEY_NOT_PRESSED = CURRENT_KEY==keycode;
                              CURRENT_KEY=keycode;
                            }
                            //Check move up
                            if ( keycode ==  PLAYER1_UP_KEYCODE && player1.y > PADDLE_START_POINT) {
                                movePlayer1Up();
                                console.log("Moving UP Start");
                            }
                            //Check move down
                            if ( keycode ==  PLAYER1_DOWN_KEYCODE && player1.y <PADDLE_END_POINT) {
                                movePlayer1Down();
                                console.log("Moving DOWN Start");
                            }
                      }
                  });
              });
              console.log("Game Logic Loaded");
          });
  </script>
</body>
</html>
